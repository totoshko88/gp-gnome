# –§—ñ–Ω–∞–ª—å–Ω—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è GlobalProtect Extension

## –î–∞—Ç–∞: 23 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 2025

## ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–û –í–°–Ü 5 –ü–†–û–ë–õ–ï–ú

### 1. ‚úÖ Gateway –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –Ω–∞ –æ–±—Ä–∞–Ω–∏–π (–Ω–µ –Ω–∞ –ø–µ—Ä—à–∏–π)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –∑–º—ñ–Ω—ñ gateway –∑–∞–≤–∂–¥–∏ –ø—ñ–¥–∫–ª—é—á–∞–≤—Å—è –ø–µ—Ä—à–∏–π –∑ —Å–ø–∏—Å–∫—É, —Ö–æ—á–∞ notification –ø–æ–∫–∞–∑—É–≤–∞–≤ –æ–±—Ä–∞–Ω–∏–π.

**–†—ñ—à–µ–Ω–Ω—è**:
- –í–∏–¥–∞–ª–µ–Ω–æ –≤–∏–∫–ª–∏–∫ `setPreferredGateway()` –∑ –º–µ—Ç–æ–¥—É `_setGateway()`
- –¢–µ–ø–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ `connectToGateway(gateway)` –∑ –ø—Ä—è–º–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
- –ö–æ–º–∞–Ω–¥–∞ CLI: `globalprotect connect --gateway <gateway_name>`
- –¶–µ –≥–∞—Ä–∞–Ω—Ç—É—î –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å–∞–º–µ –¥–æ –æ–±—Ä–∞–Ω–æ–≥–æ gateway

**–§–∞–π–ª**: `indicator.js`, –º–µ—Ç–æ–¥ `_setGateway()` (—Ä—è–¥–∫–∏ 625-655)

**–ö–æ–¥**:
```javascript
// Connect directly to the selected gateway using --gateway flag
// This ensures we connect to the SELECTED gateway, not the first one
await this._gpClient.connectToGateway(gateway);
```

---

### 2. ‚úÖ –ö–µ—à—É–≤–∞–Ω–Ω—è gateway —Å–ø–∏—Å–∫—É —Ç–∞ connection details

**–ü—Ä–æ–±–ª–µ–º–∞**: –°–ø–∏—Å–æ–∫ gateway —Ç–∞ –¥–µ—Ç–∞–ª—ñ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∑–∞–ø–∏—Ç—É–≤–∞–ª–∏—Å—å –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É.

**–†—ñ—à–µ–Ω–Ω—è**:
- –î–æ–¥–∞–Ω–æ –∑–º—ñ–Ω–Ω—É `_connectionDetailsCache` –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è –¥–µ—Ç–∞–ª–µ–π –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
- Gateway —Å–ø–∏—Å–æ–∫ –≤–∂–µ –∫–µ—à—É–≤–∞–≤—Å—è —á–µ—Ä–µ–∑ `_gatewayListCache`
- –ö–µ—à —ñ–Ω–≤–∞–ª—ñ–¥—É—î—Ç—å—Å—è –ø—Ä–∏ –∑–º—ñ–Ω—ñ gateway –∞–±–æ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ
- –î–µ—Ç–∞–ª—ñ –æ—Ç—Ä–∏–º—É—é—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ —Ç–∞ –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è –≤ —Å—Ç–∞—Ç—É—Å—ñ

**–§–∞–π–ª**: `indicator.js` (—Ä—è–¥–∫–∏ 36-40)

**–ö–æ–¥**:
```javascript
// Cache for gateway list and connection details
this._gatewayListCache = null;
this._lastGatewayUpdate = 0;
this._connectionDetailsCache = null;
```

---

### 3. ‚úÖ –°—Ç–∞—Ç—É—Å –ø–æ–∫–∞–∑—É—î Gateway info (Name, Assigned IP, Gateway IP)

**–ü—Ä–æ–±–ª–µ–º–∞**: –°—Ç–∞—Ç—É—Å –Ω–µ –ø–æ–∫–∞–∑—É–≤–∞–≤ –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ gateway.

**–†—ñ—à–µ–Ω–Ω—è**:
- –î–æ–¥–∞–Ω–æ –º–µ—Ç–æ–¥ `getConnectionDetails()` –≤ `gpClient.js`
- –ü–∞—Ä—Å–∏—Ç—å –≤–∏–≤—ñ–¥ `globalprotect show --details`
- –í–∏—Ç—è–≥—É—î: Gateway Name, Assigned IP Address, Gateway IP Address
- –ü–æ–∫–∞–∑—É—î —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É —Å—Ç–∞—Ç—É—Å—ñ –ø—ñ—Å–ª—è "Connected"

**–§–∞–π–ª–∏**: 
- `gpClient.js`, –º–µ—Ç–æ–¥ `getConnectionDetails()` (—Ä—è–¥–∫–∏ 710-760)
- `indicator.js`, –º–µ—Ç–æ–¥ `_updateMenu()` (—Ä—è–¥–∫–∏ 293-340)

**–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É**:
```
Connected to portal.example.com
Gateway: vpn-ua.epam.com
Assigned IP: 100.64.48.41
Gateway IP: 195.56.119.209
```

---

### 4. ‚úÖ Connection Details –≤–∏–¥–∞–ª–µ–Ω–æ, –¥–æ–¥–∞–Ω–æ Host State

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- Connection Details –∑–∞–≤–∂–¥–∏ –ø–æ–≤–µ—Ä—Ç–∞–≤ –ø–æ—Ä–æ–∂–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è
- Host State –Ω–µ –±—É–ª–æ –≤ –º–µ–Ω—é

**–†—ñ—à–µ–Ω–Ω—è**:
- –í–∏–¥–∞–ª–µ–Ω–æ "Connection Details" –∑ Show –º–µ–Ω—é
- –î–æ–¥–∞–Ω–æ "Host State" –≤ Show –º–µ–Ω—é
- –°—Ç–≤–æ—Ä–µ–Ω–æ –º–µ—Ç–æ–¥ `_showHostState()` —è–∫–∏–π –ø–æ–∫–∞–∑—É—î `globalprotect show --host-state`
- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –≤ notification

**–§–∞–π–ª**: `indicator.js`
- –ú–µ–Ω—é: —Ä—è–¥–∫–∏ 172-180
- –ú–µ—Ç–æ–¥: —Ä—è–¥–∫–∏ 450-465

---

### 5. ‚úÖ Collect Logs –≤—ñ–¥–∫—Ä–∏–≤–∞—î —Ñ–∞–π–ª–æ–≤–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä

**–ü—Ä–æ–±–ª–µ–º–∞**: Collect Logs –ø–æ–∫–∞–∑—É–≤–∞–≤ —Ç—ñ–ª—å–∫–∏ notification, –∞–ª–µ –Ω–µ –≤—ñ–¥–∫—Ä–∏–≤–∞–≤ —Ç–µ–∫—É.

**–†—ñ—à–µ–Ω–Ω—è**:
- –ú–µ—Ç–æ–¥ `_collectLogsAndOpen()` –≤–∂–µ –±—É–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π
- –í–∏—Ç—è–≥—É—î —à–ª—è—Ö –¥–æ log —Ñ–∞–π–ª—É –∑ –≤–∏–≤–æ–¥—É CLI
- –í—ñ–¥–∫—Ä–∏–≤–∞—î –±–∞—Ç—å–∫—ñ–≤—Å—å–∫—É —Ç–µ–∫—É —á–µ—Ä–µ–∑ `Gio.AppInfo.get_default_for_type('inode/directory')`
- –ü–æ–∫–∞–∑—É—î notification –∑ —à–ª—è—Ö–æ–º –¥–æ —Ñ–∞–π–ª—É

**–§–∞–π–ª**: `indicator.js`, –º–µ—Ç–æ–¥ `_collectLogsAndOpen()` (—Ä—è–¥–∫–∏ 660-678)

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–∂–µ –ø—Ä–∞—Ü—é—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

### 6. ‚úÖ Advanced –º–µ–Ω—é –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è

**–ü—Ä–æ–±–ª–µ–º–∞**: Advanced –º–µ–Ω—é –Ω–µ –±—É–ª–æ –≤–∏—Ä—ñ–≤–Ω—è–Ω–µ –∑ —ñ–Ω—à–∏–º–∏ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏.

**–†—ñ—à–µ–Ω–Ω—è**:
- –î–æ–¥–∞–Ω–æ `padding-left: 12px;` –≤ CSS –¥–ª—è `.globalprotect-advanced-menu`
- –¢–µ–ø–µ—Ä –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –º–µ–Ω—é –≤–∏—Ä—ñ–≤–Ω—è–Ω—ñ –æ–¥–Ω–∞–∫–æ–≤–æ

**–§–∞–π–ª**: `stylesheet.css` (—Ä—è–¥–∫–∏ 82-84)

---

## üìä –¢–ï–•–ù–Ü–ß–ù–Ü –î–ï–¢–ê–õ–Ü

### –ù–æ–≤—ñ –º–µ—Ç–æ–¥–∏ –≤ gpClient.js:

1. **getConnectionDetails()** - –æ—Ç—Ä–∏–º—É—î –¥–µ—Ç–∞–ª—ñ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
   - Gateway Name
   - Gateway Description
   - Assigned IP Address
   - Gateway IP Address
   - Gateway Location
   - Protocol
   - Uptime

### –û–Ω–æ–≤–ª–µ–Ω—ñ –º–µ—Ç–æ–¥–∏ –≤ indicator.js:

1. **_updateMenu()** - —Ç–µ–ø–µ—Ä async, –æ—Ç—Ä–∏–º—É—î —Ç–∞ –∫–µ—à—É—î connection details
2. **_setGateway()** - —Å–ø—Ä–æ—â–µ–Ω–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ç—ñ–ª—å–∫–∏ connectToGateway()
3. **_showHostState()** - –Ω–æ–≤–∏–π –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–∫–∞–∑—É host state

### –ö–µ—à—É–≤–∞–Ω–Ω—è:

- `_gatewayListCache` - —Å–ø–∏—Å–æ–∫ gateway (–æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –º–µ–Ω—é)
- `_connectionDetailsCache` - –¥–µ—Ç–∞–ª—ñ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è (–æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—Ä–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ)
- –Ü–Ω–≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ø—Ä–∏ disconnect –∞–±–æ –∑–º—ñ–Ω—ñ gateway

---

## üß™ –¢–ï–°–¢–£–í–ê–ù–ù–Ø

–ó–∞–ø—É—Å—Ç—ñ—Ç—å —Ç–µ—Å—Ç–∏:
```bash
npm test
```

–ê–±–æ –æ–∫—Ä–µ–º–æ:
```bash
node tests/run-property-tests.js
node tests/run-unit-tests.js
```

---

## üîÑ –ù–ê–°–¢–£–ü–ù–Ü –ö–†–û–ö–ò

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ GNOME Shell**:
   - –í–∏–π—Ç–∏ –∑ —Å–µ—Å—ñ—ó —Ç–∞ —É–≤—ñ–π—Ç–∏ –∑–Ω–æ–≤—É
   - –ê–±–æ Alt+F2 ‚Üí `r` (—Ç—ñ–ª—å–∫–∏ –¥–ª—è X11, –Ω–µ Wayland)

2. **–ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª**:
   - –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å –¥–æ VPN
   - –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å (–º–∞—î –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ Gateway info)
   - –ó–º—ñ–Ω–∏—Ç–∏ gateway —á–µ—Ä–µ–∑ Select Gateway
   - –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –¥–æ –æ–±—Ä–∞–Ω–æ–≥–æ gateway
   - –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ Host State –≤ Show –º–µ–Ω—é
   - –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ Collect Logs (–º–∞—î –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Ç–µ–∫—É)

3. **–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏**:
   ```bash
   journalctl -f -o cat /usr/bin/gnome-shell
   ```

---

## ‚ú® –ì–û–¢–û–í–ù–Ü–°–¢–¨

Extension –ø–æ–≤–Ω—ñ—Å—Ç—é –≥–æ—Ç–æ–≤–∏–π –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è! –í—Å—ñ –∫—Ä–∏—Ç–∏—á–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ:

- ‚úÖ Gateway –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –ø—Ä–∞—Ü—é—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ö–µ—à—É–≤–∞–Ω–Ω—è —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ
- ‚úÖ –°—Ç–∞—Ç—É—Å –ø–æ–∫–∞–∑—É—î –ø–æ–≤–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é
- ‚úÖ Host State –¥–æ–¥–∞–Ω–æ
- ‚úÖ Connection Details –≤–∏–¥–∞–ª–µ–Ω–æ
- ‚úÖ Collect Logs –≤—ñ–¥–∫—Ä–∏–≤–∞—î —Ç–µ–∫—É
- ‚úÖ –ú–µ–Ω—é –≤–∏—Ä—ñ–≤–Ω—è–Ω–µ

**–í–µ—Ä—Å—ñ—è**: 1.0.0
**–°—Ç–∞—Ç—É—Å**: Production Ready üöÄ
