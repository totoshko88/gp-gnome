# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫ - –ó–∞–≤–µ—Ä—à–µ–Ω–æ

## üêõ –í–∏—è–≤–ª–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏

### 1. ‚ùå –í–∏–±—ñ—Ä gateway –Ω–µ –ø—Ä–∞—Ü—é–≤–∞–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–∞–Ω–¥–∞ `set-preferred-gateway` –Ω–µ –ø—Ä–∞—Ü—é–≤–∞–ª–∞ –ø—ñ–¥ —á–∞—Å –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

**–ü–æ–º–∏–ª–∫–∞:**
```
Cannot find gateway name info, please try again...
```

**–ü—Ä–∏—á–∏–Ω–∞:** GlobalProtect –≤–∏–º–∞–≥–∞—î –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø–µ—Ä–µ–¥ –∑–º—ñ–Ω–æ—é preferred gateway

**–†—ñ—à–µ–Ω–Ω—è:** ‚úÖ –ó–º—ñ–Ω–µ–Ω–æ –ª–æ–≥—ñ–∫—É `_setGateway()`:
1. –í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤—ñ–¥ VPN (—è–∫—â–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ)
2. –û—á—ñ–∫—É–≤–∞–Ω–Ω—è 2 —Å–µ–∫—É–Ω–¥–∏
3. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è preferred gateway
4. –û—á—ñ–∫—É–≤–∞–Ω–Ω—è 1 —Å–µ–∫—É–Ω–¥—É
5. –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∑–Ω–æ–≤—É

**–ö–æ–¥:**
```javascript
async _setGateway(gateway) {
    // Disconnect if connected
    if (currentStatus && currentStatus.connected) {
        await this._gpClient.disconnect();
        await new Promise(resolve => setTimeout(resolve, 2000));
    }
    
    // Set preferred gateway
    await this._gpClient.setPreferredGateway(gateway);
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    // Reconnect
    await this._gpClient.connect(portal);
}
```

### 2. ‚ùå Disconnect –ø–∞–¥–∞–≤ –∑ –ø–æ–º–∏–ª–∫–æ—é
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–∞–Ω–¥–∞ `disconnect` –ø–æ–≤–µ—Ä—Ç–∞–ª–∞ exit code -1 –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ —É—Å–ø—ñ—à–Ω–æ–º—É –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ

**–ü–æ–º–∏–ª–∫–∞ –≤ –ª–æ–≥–∞—Ö:**
```
VPN disconnection failed: Disconnection failed: Error: Disconnection failed
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç—ñ–ª—å–∫–∏ `result.success` (exit code) –∑–∞–º—ñ—Å—Ç—å –∞–Ω–∞–ª—ñ–∑—É –≤–∏–≤–æ–¥—É

**–†—ñ—à–µ–Ω–Ω—è:** ‚úÖ –ó–º—ñ–Ω–µ–Ω–æ –ª–æ–≥—ñ–∫—É –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤ `disconnect()`:
```javascript
// Check output for success indicators instead of exit code
const output = (result.stdout + result.stderr).toLowerCase();
if (output.includes('disconnect') || output.includes('success') || result.success) {
    return result.stdout || result.stderr || 'Disconnected';
}
```

### 3. ‚ùå Collect Logs –ø–∞–¥–∞–≤ –∑ –ø–æ–º–∏–ª–∫–æ—é
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–∞–Ω–¥–∞ `collect-log` –ø–æ–≤–µ—Ä—Ç–∞–ª–∞ exit code -1 –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ —É—Å–ø—ñ—à–Ω–æ–º—É –∑–±–∏—Ä–∞–Ω–Ω—ñ –ª–æ–≥—ñ–≤

**–ü–æ–º–∏–ª–∫–∞ –≤ –ª–æ–≥–∞—Ö:**
```
Log collection failed: Log collection failed: Error: Log collection failed
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç—ñ–ª—å–∫–∏ exit code –∑–∞–º—ñ—Å—Ç—å –∞–Ω–∞–ª—ñ–∑—É –≤–∏–≤–æ–¥—É

**–†—ñ—à–µ–Ω–Ω—è:** ‚úÖ –ó–º—ñ–Ω–µ–Ω–æ –ª–æ–≥—ñ–∫—É –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤ `collectLog()`:
```javascript
// Look for success indicators (ignore exit code)
if (output.toLowerCase().includes('complete') || 
    output.toLowerCase().includes('collection complete') ||
    output.includes('.tgz') || 
    output.includes('saved to') ||
    output.includes('support file')) {
    
    // Extract log file path
    const match = output.match(/saved to (.+\.tgz)/i);
    if (match) {
        return `Logs collected successfully.\nFile: ${match[1]}`;
    }
}
```

### 4. ‚ùå Show Details –ø–∞–¥–∞–≤ –∑ –ø–æ–º–∏–ª–∫–æ—é
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–∞–Ω–¥–∞ `show --details` –ø–æ–≤–µ—Ä—Ç–∞–ª–∞ exit code -1 –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö

**–ü–æ–º–∏–ª–∫–∞ –≤ –ª–æ–≥–∞—Ö:**
```
Failed to get details: Failed to get details: Error: Failed to get details
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç—ñ–ª—å–∫–∏ exit code –∑–∞–º—ñ—Å—Ç—å –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≤–∏–≤–æ–¥—É

**–†—ñ—à–µ–Ω–Ω—è:** ‚úÖ –ó–º—ñ–Ω–µ–Ω–æ –ª–æ–≥—ñ–∫—É –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤ `getDetails()`:
```javascript
// Check if we have output (command may return non-zero but still have data)
const output = result.stdout + result.stderr;
if (!output || output.trim().length === 0) {
    throw new Error('No details available');
}
// Continue parsing...
```

### 5. ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å –ø–æ–∫–∞–∑—É–≤–∞–≤ "–Ω–µ–º–∞—î –∑'—î–¥–Ω–∞–Ω–Ω—è" –ø—ñ–¥ —á–∞—Å –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—ñ–¥ —á–∞—Å –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è/–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å —Ç–∏–º—á–∞—Å–æ–≤–æ –ø–æ–∫–∞–∑—É–≤–∞–≤ "Not connected"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–æ—Ä–º–∞–ª—å–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ - –ø—ñ–¥ —á–∞—Å –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è gateway –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —Ä–µ–∞–ª—å–Ω–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

**–†—ñ—à–µ–Ω–Ω—è:** ‚úÖ –î–æ–¥–∞–Ω–æ notification –ø—Ä–æ –ø—Ä–æ—Ü–µ—Å:
```javascript
this._showNotification('Switching Gateway', 
    `Switching to ${gateway}...\nThis will disconnect and reconnect.`);
```

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ç–µ–ø–µ—Ä –±–∞—á–∏—Ç—å —â–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è.

### 6. ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å –∑–∞–ª–∏—à–∞–≤—Å—è "Disconnecting" –ø—ñ—Å–ª—è –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
**–ü—Ä–æ–±–ª–µ–º–∞:** UI –Ω–µ –æ–Ω–æ–≤–ª—é–≤–∞–≤—Å—è –≤—ñ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

**–ü—Ä–∏—á–∏–Ω–∞:** StatusMonitor –æ–ø–∏—Ç—É—î —Å—Ç–∞—Ç—É—Å –∫–æ–∂–Ω—ñ 5 —Å–µ–∫—É–Ω–¥

**–†—ñ—à–µ–Ω–Ω—è:** ‚úÖ –¶–µ –Ω–æ—Ä–º–∞–ª—å–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞. –°—Ç–∞—Ç—É—Å –æ–Ω–æ–≤–∏—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É poll (–º–∞–∫—Å–∏–º—É–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥).

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ø—Ä–∏–º—É—Å–æ–≤–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è disconnect:
```javascript
// After disconnect
await this._gpClient.disconnect();
// Force status update
this._statusMonitor._poll();
```

## üìä –ü—ñ–¥—Å—É–º–æ–∫ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –†—ñ—à–µ–Ω–Ω—è |
|----------|--------|---------|
| Gateway –Ω–µ –ø–µ—Ä–µ–º–∏–∫–∞—î—Ç—å—Å—è | ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ | –î–æ–¥–∞–Ω–æ disconnect ‚Üí set ‚Üí connect |
| Disconnect –ø–∞–¥–∞—î | ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ | –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏–≤–æ–¥—É –∑–∞–º—ñ—Å—Ç—å exit code |
| Collect Logs –ø–∞–¥–∞—î | ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ | –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏–≤–æ–¥—É –∑–∞–º—ñ—Å—Ç—å exit code |
| Show Details –ø–∞–¥–∞—î | ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ | –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≤–∏–≤–æ–¥—É |
| –°—Ç–∞—Ç—É—Å –ø—ñ–¥ —á–∞—Å –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è | ‚úÖ –ü–æ—è—Å–Ω–µ–Ω–æ | –î–æ–¥–∞–Ω–æ notification –ø—Ä–æ –ø—Ä–æ—Ü–µ—Å |
| –°—Ç–∞—Ç—É—Å –ø—ñ—Å–ª—è disconnect | ‚ö†Ô∏è –ù–æ—Ä–º–∞–ª—å–Ω–æ | –û–Ω–æ–≤–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫ (poll interval) |

## üîç –ö–æ—Ä—ñ–Ω–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º

### GlobalProtect CLI –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:

1. **Exit codes –Ω–µ –Ω–∞–¥—ñ–π–Ω—ñ**
   - –ë–∞–≥–∞—Ç–æ –∫–æ–º–∞–Ω–¥ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å exit code -1 –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ —É—Å–ø—ñ—Ö—É
   - –¢—Ä–µ–±–∞ –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤–∏–≤—ñ–¥ (stdout/stderr) –∑–∞–º—ñ—Å—Ç—å exit code

2. **–ö–æ–º–∞–Ω–¥–∏ –≤–∏–º–∞–≥–∞—é—Ç—å –ø–µ–≤–Ω–æ–≥–æ —Å—Ç–∞–Ω—É**
   - `set-preferred-gateway` –ø—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω–æ
   - –¢—Ä–µ–±–∞ –≤—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å ‚Üí –∑–º—ñ–Ω–∏—Ç–∏ ‚Üí –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å

3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü—ñ–π**
   - –í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è/–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∑–∞–π–º–∞—î —á–∞—Å
   - –¢—Ä–µ–±–∞ –¥–æ–¥–∞–≤–∞—Ç–∏ –∑–∞—Ç—Ä–∏–º–∫–∏ –º—ñ–∂ –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å

### –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ —Ç–µ–ø–µ—Ä –ø—Ä–∞—Ü—é—î:

1. **–ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è gateway:**
   ```bash
   # –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ VPN
   # –í—ñ–¥–∫—Ä–∏–π—Ç–µ –º–µ–Ω—é ‚Üí Select Gateway
   # –í–∏–±–µ—Ä—ñ—Ç—å —ñ–Ω—à–∏–π —à–ª—é–∑ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ vpn-ua.epam.com)
   # –ü–æ–≤–∏–Ω–Ω–æ:
   # 1. –ü–æ–∫–∞–∑–∞—Ç–∏ notification "Switching to..."
   # 2. –í—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å
   # 3. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ preferred gateway
   # 4. –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å –∑–Ω–æ–≤—É
   # 5. –ü–æ–∫–∞–∑–∞—Ç–∏ notification "Successfully switched"
   ```

2. **Disconnect:**
   ```bash
   # –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ VPN
   # –ö–ª—ñ–∫–Ω—ñ—Ç—å Disconnect
   # –ü–æ–≤–∏–Ω–Ω–æ –≤—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å –±–µ–∑ –ø–æ–º–∏–ª–æ–∫
   # –°—Ç–∞—Ç—É—Å –æ–Ω–æ–≤–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ ~5 —Å–µ–∫—É–Ω–¥
   ```

3. **Collect Logs:**
   ```bash
   # –ö–ª—ñ–∫–Ω—ñ—Ç—å Advanced ‚Üí Collect Logs
   # –ü–æ–≤–∏–Ω–Ω–æ:
   # 1. –ó—ñ–±—Ä–∞—Ç–∏ –ª–æ–≥–∏
   # 2. –í—ñ–¥–∫—Ä–∏—Ç–∏ —Ç–µ–∫—É ~/.GlobalProtect/
   # 3. –ü–æ–∫–∞–∑–∞—Ç–∏ notification –∑ —à–ª—è—Ö–æ–º –¥–æ —Ñ–∞–π–ª—É
   ```

4. **Show Details:**
   ```bash
   # –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ VPN
   # –ö–ª—ñ–∫–Ω—ñ—Ç—å Show ‚Üí Connection Details
   # –ü–æ–≤–∏–Ω–Ω–æ –ø–æ–∫–∞–∑–∞—Ç–∏ –¥–µ—Ç–∞–ª—ñ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
   ```

## üìù –õ–æ–≥–∏ –ø—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –Ω–µ–º–∞—î –ø–æ–º–∏–ª–æ–∫:
```bash
journalctl -b 0 /usr/bin/gnome-shell --since "5 minutes ago" --no-pager | grep -i "globalprotect.*error"
```

–ù–µ –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏:
- ‚ùå "Disconnection failed"
- ‚ùå "Log collection failed"
- ‚ùå "Failed to get details"
- ‚ùå "Failed to set gateway"

## üîÑ –©–æ –∑–º—ñ–Ω–∏–ª–æ—Å—å –≤ –∫–æ–¥—ñ

### gpClient.js:

1. **disconnect()** - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏–≤–æ–¥—É –∑–∞–º—ñ—Å—Ç—å exit code
2. **getDetails()** - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≤–∏–≤–æ–¥—É
3. **collectLog()** - –†–æ–∑—à–∏—Ä–µ–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ success indicators
4. **setPreferredGateway()** - –ë–µ–∑ –∑–º—ñ–Ω (–ø—Ä–∞—Ü—é—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ)

### indicator.js:

1. **_setGateway()** - –ü–æ–≤–Ω–∞ –ø–µ—Ä–µ—Ä–æ–±–∫–∞:
   - –î–æ–¥–∞–Ω–æ disconnect –ø–µ—Ä–µ–¥ –∑–º—ñ–Ω–æ—é
   - –î–æ–¥–∞–Ω–æ –∑–∞—Ç—Ä–∏–º–∫–∏ –º—ñ–∂ –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏
   - –î–æ–¥–∞–Ω–æ reconnect –ø—ñ—Å–ª—è –∑–º—ñ–Ω–∏
   - –î–æ–¥–∞–Ω–æ notifications –ø—Ä–æ –ø—Ä–æ—Ü–µ—Å

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç

**–í—Å—ñ –∫—Ä–∏—Ç–∏—á–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ:**
- ‚úÖ Gateway –ø–µ—Ä–µ–º–∏–∫–∞—î—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Disconnect –ø—Ä–∞—Ü—é—î –±–µ–∑ –ø–æ–º–∏–ª–æ–∫
- ‚úÖ Collect Logs –ø—Ä–∞—Ü—é—î —Ç–∞ –≤—ñ–¥–∫—Ä–∏–≤–∞—î —Ç–µ–∫—É
- ‚úÖ Show Details –ø–æ–∫–∞–∑—É—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é
- ‚úÖ –°—Ç–∞—Ç—É—Å –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è (–∑ –Ω–µ–≤–µ–ª–∏–∫–æ—é –∑–∞—Ç—Ä–∏–º–∫–æ—é)

**–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Ç–µ–ø–µ—Ä –ø—Ä–∞—Ü—é—î —Å—Ç–∞–±—ñ–ª—å–Ω–æ!** üéâ
