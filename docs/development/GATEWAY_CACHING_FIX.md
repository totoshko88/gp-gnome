# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –∫–µ—à—É–≤–∞–Ω–Ω—è —Å–ø–∏—Å–∫—É Gateway

## –î–∞—Ç–∞: 23 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 2025

## ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–û

### –ü—Ä–æ–±–ª–µ–º–∞

–ü—ñ—Å–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ VPN —Å–ø–∏—Å–æ–∫ –≥–µ–π—Ç–≤–µ—ó–≤ –ø–æ–∫–∞–∑—É–≤–∞–≤ "No gateways available" —ñ –∑'—è–≤–ª—è–≤—Å—è –Ω–µ –æ–¥—Ä–∞–∑—É. –ü–æ—Ç—Ä—ñ–±–Ω–æ –±—É–ª–æ:
1. –ó–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –ø—ñ—Å–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
2. –ö–µ—à—É–≤–∞—Ç–∏ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
3. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–µ—à –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è

### –†—ñ—à–µ–Ω–Ω—è

–†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –∫–µ—à—É–≤–∞–Ω–Ω—è —Å–ø–∏—Å–∫—É –≥–µ–π—Ç–≤–µ—ó–≤:

#### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—ñ—Å–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

**–§–∞–π–ª**: `indicator.js`, –º–µ—Ç–æ–¥ `_onStatusChanged()` (—Ä—è–¥–∫–∏ 253-275)

```javascript
_onStatusChanged(_monitor, status) {
    this._updateIcon(status);
    this._updateMenu(status);
    
    // Clear transitioning states when status changes to connected/disconnected
    if (status && (status.connected || !this._isMfaWaiting)) {
        this._isConnecting = false;
        this._isDisconnecting = false;
        this._isMfaWaiting = false;
        
        // Load gateway list after connection is established
        if (status.connected && !this._gatewayListCache) {
            this._loadGatewayList();
        }
    }
    
    // Clear gateway cache when disconnected
    if (status && !status.connected) {
        this._gatewayListCache = null;
        this._connectionDetailsCache = null;
    }
}
```

**–õ–æ–≥—ñ–∫–∞**:
- –ü—Ä–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ (`status.connected = true`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —Å–ø–∏—Å–æ–∫ –≥–µ–π—Ç–≤–µ—ó–≤
- –ü—Ä–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ –∫–µ—à –æ—á–∏—â—É—î—Ç—å—Å—è

#### 2. –ú–µ—Ç–æ–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –∫–µ—à—É–≤–∞–Ω–Ω—è

**–§–∞–π–ª**: `indicator.js`, –Ω–æ–≤–∏–π –º–µ—Ç–æ–¥ `_loadGatewayList()` (—Ä—è–¥–∫–∏ 540-550)

```javascript
async _loadGatewayList() {
    try {
        const gateways = await this._gpClient.getGateways();
        if (gateways && gateways.length > 0) {
            this._gatewayListCache = gateways;
            this._lastGatewayUpdate = Date.now();
        }
    } catch (e) {
        ErrorHandler.handle(e, 'Failed to load gateway list', {notify: false, log: true});
    }
}
```

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª**:
- –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î —Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ CLI (`globalprotect show --manual-gateway`)
- –ó–±–µ—Ä—ñ–≥–∞—î –≤ `_gatewayListCache`
- –ó–∞–ø–∏—Å—É—î —á–∞—Å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤ `_lastGatewayUpdate`
- –ü–æ–º–∏–ª–∫–∏ –ª–æ–≥—É—é—Ç—å—Å—è –∞–ª–µ –Ω–µ –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É

#### 3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫–µ—à—É –≤ –º–µ–Ω—é

**–§–∞–π–ª**: `indicator.js`, –º–µ—Ç–æ–¥ `_updateGatewayMenu()` (—Ä—è–¥–∫–∏ 552-620)

```javascript
async _updateGatewayMenu() {
    try {
        // Clear existing items
        this._gatewayMenu.menu.removeAll();
        
        // Use cached gateways if available, otherwise fetch
        let gateways = this._gatewayListCache;
        
        if (!gateways) {
            // Try to fetch gateways
            gateways = await this._gpClient.getGateways();
            
            // Cache if we got results
            if (gateways && gateways.length > 0) {
                this._gatewayListCache = gateways;
                this._lastGatewayUpdate = Date.now();
            }
        }
        
        // ... rest of menu building
    }
}
```

**–õ–æ–≥—ñ–∫–∞**:
- –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä—è—î –∫–µ—à
- –Ø–∫—â–æ –∫–µ—à –ø–æ—Ä–æ–∂–Ω—ñ–π, –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –∑ CLI
- –Ø–∫—â–æ –æ—Ç—Ä–∏–º–∞–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏, –∫–µ—à—É—î —ó—Ö

#### 4. –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–µ—à —Ç–∞ –∫–Ω–æ–ø–∫–∞ Refresh

**–î–æ–¥–∞–Ω–æ –≤ –º–µ–Ω—é**:

```javascript
// Show cache age
const cacheAge = this._lastGatewayUpdate ? Math.floor((Date.now() - this._lastGatewayUpdate) / 1000) : 0;
const cacheInfo = cacheAge > 0 ? ` (cached ${cacheAge}s ago)` : '';
const countItem = new PopupMenu.PopupMenuItem(`${gateways.length} gateway(s) available${cacheInfo}`, {
    reactive: false
});

// Add refresh button
const refreshItem = new PopupMenu.PopupMenuItem('üîÑ Refresh List');
refreshItem.connect('activate', () => {
    this._gatewayListCache = null;
    this._updateGatewayMenu();
});
```

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª**:
- –ü–æ–∫–∞–∑—É—î —Å–∫—ñ–ª—å–∫–∏ —Å–µ–∫—É–Ω–¥ —Ç–æ–º—É –æ–Ω–æ–≤–ª—é–≤–∞–≤—Å—è —Å–ø–∏—Å–æ–∫
- –ö–Ω–æ–ø–∫–∞ "üîÑ Refresh List" –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
- –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –æ—á–∏—â–∞—î –∫–µ—à —ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –∑–Ω–æ–≤—É

### –ü–µ—Ä–µ–≤–∞–≥–∏

1. **–®–≤–∏–¥–∫–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è** - —Å–ø–∏—Å–æ–∫ –∑'—è–≤–ª—è—î—Ç—å—Å—è –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
2. **–ö–µ—à—É–≤–∞–Ω–Ω—è** - –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ CLI –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è** - –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –ø—Ä–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ
4. **–†—É—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è** - –∫–Ω–æ–ø–∫–∞ Refresh –¥–ª—è –ø—Ä–∏–º—É—Å–æ–≤–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
5. **–Ü–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ñ—Å—Ç—å** - –ø–æ–∫–∞–∑—É—î –≤—ñ–∫ –∫–µ—à—É
6. **–û—á–∏—â–µ–Ω–Ω—è** - –∫–µ—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—á–∏—â–∞—î—Ç—å—Å—è –ø—Ä–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ

### –ñ–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª –∫–µ—à—É

```
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –¥–æ VPN
   ‚Üì
2. _onStatusChanged() –≤–∏—è–≤–ª—è—î status.connected = true
   ‚Üì
3. –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è _loadGatewayList()
   ‚Üì
4. –°–ø–∏—Å–æ–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –∑ CLI —Ç–∞ –∫–µ—à—É—î—Ç—å—Å—è
   ‚Üì
5. –ü—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –º–µ–Ω—é Select Gateway –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∫–µ—à
   ‚Üì
6. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ–¥—Ä–∞–∑—É (–±–µ–∑ –∑–∞—Ç—Ä–∏–º–∫–∏)
   ‚Üì
7. –ü—Ä–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ –∫–µ—à –æ—á–∏—â–∞—î—Ç—å—Å—è
```

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

**–°—Ü–µ–Ω–∞—Ä—ñ–π 1 - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è**:
1. –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å –¥–æ VPN
2. –ó–∞—á–µ–∫–∞—Ç–∏ 2-3 —Å–µ–∫—É–Ω–¥–∏ (–ø–æ–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è —Å–ø–∏—Å–æ–∫)
3. –í—ñ–¥–∫—Ä–∏—Ç–∏ Select Gateway
4. –°–ø–∏—Å–æ–∫ –º–∞—î –∑'—è–≤–∏—Ç–∏—Å—å –æ–¥—Ä–∞–∑—É

**–°—Ü–µ–Ω–∞—Ä—ñ–π 2 - –ö–µ—à—É–≤–∞–Ω–Ω—è**:
1. –í—ñ–¥–∫—Ä–∏—Ç–∏ Select Gateway (—Å–ø–∏—Å–æ–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è)
2. –ó–∞–∫—Ä–∏—Ç–∏ –º–µ–Ω—é
3. –í—ñ–¥–∫—Ä–∏—Ç–∏ Select Gateway –∑–Ω–æ–≤—É
4. –°–ø–∏—Å–æ–∫ –º–∞—î –∑'—è–≤–∏—Ç–∏—Å—å –º–∏—Ç—Ç—î–≤–æ (–∑ –∫–µ—à—É)
5. –ú–∞—î –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏—Å—å "(cached Xs ago)"

**–°—Ü–µ–Ω–∞—Ä—ñ–π 3 - –†—É—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è**:
1. –í—ñ–¥–∫—Ä–∏—Ç–∏ Select Gateway
2. –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ "üîÑ Refresh List"
3. –°–ø–∏—Å–æ–∫ –º–∞—î –æ–Ω–æ–≤–∏—Ç–∏—Å—å
4. –ß–∞—Å –∫–µ—à—É –º–∞—î —Å–∫–∏–Ω—É—Ç–∏—Å—å

**–°—Ü–µ–Ω–∞—Ä—ñ–π 4 - –û—á–∏—â–µ–Ω–Ω—è –ø—Ä–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ**:
1. –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å, –≤—ñ–¥–∫—Ä–∏—Ç–∏ Select Gateway (—Å–ø–∏—Å–æ–∫ —î)
2. –í—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å
3. –í—ñ–¥–∫—Ä–∏—Ç–∏ Select Gateway
4. –ú–∞—î –ø–æ–∫–∞–∑–∞—Ç–∏ "No gateways available"

## üìä –ü–Ü–î–°–£–ú–û–ö

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ**: ‚úÖ –ö–µ—à—É–≤–∞–Ω–Ω—è —Å–ø–∏—Å–∫—É –≥–µ–π—Ç–≤–µ—ó–≤  
**–î–æ–¥–∞–Ω–æ**: 
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—ñ—Å–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
- –ú–µ—Ç–æ–¥ `_loadGatewayList()`
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫–µ—à—É –≤ `_updateGatewayMenu()`
- –ö–Ω–æ–ø–∫–∞ "üîÑ Refresh List"
- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤—ñ–∫ –∫–µ—à—É
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è –ø—Ä–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ

**–§–∞–π–ª–∏ –∑–º—ñ–Ω–µ–Ω–æ**: `indicator.js`

## üîÑ –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ GNOME Shell** (–≤–∏–π—Ç–∏/—É–≤—ñ–π—Ç–∏)
2. **–ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏** –≤—Å—ñ 4 —Å—Ü–µ–Ω–∞—Ä—ñ—ó –≤–∏—â–µ
3. **–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏** –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫:
   ```bash
   journalctl -f -o cat /usr/bin/gnome-shell | grep -i globalprotect
   ```

## ‚ú® –°—Ç–∞—Ç—É—Å

**–í–µ—Ä—Å—ñ—è**: 1.0.3  
**–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å**: Ready for Testing üß™  
**–ö—Ä–∏—Ç–∏—á–Ω—ñ—Å—Ç—å**: High - –ø–æ–∫—Ä–∞—â—É—î UX
