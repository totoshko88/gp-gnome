# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º - –†–∞—É–Ω–¥ 2

## –î–∞—Ç–∞: 23 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 2025

## ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–û 3 –ü–†–û–ë–õ–ï–ú–ò

### 1. ‚úÖ –ü–æ–º–∏–ª–∫–∞ "checkStatus is not a function"

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –∑–º—ñ–Ω—ñ gateway –≤–∏–Ω–∏–∫–∞–ª–∞ –ø–æ–º–∏–ª–∫–∞ `this._statusMonitor.checkStatus is not a function`

**–ü—Ä–∏—á–∏–Ω–∞**: –ú–µ—Ç–æ–¥ `checkStatus()` –Ω–µ —ñ—Å–Ω—É—î –≤ –∫–ª–∞—Å—ñ `StatusMonitor`

**–†—ñ—à–µ–Ω–Ω—è**: –ó–∞–º—ñ–Ω–µ–Ω–æ –≤–∏–∫–ª–∏–∫ –Ω–∞ `_poll()` —è–∫–∏–π —î –ø—Ä–∏–≤–∞—Ç–Ω–∏–º –º–µ—Ç–æ–¥–æ–º –¥–ª—è –Ω–µ–≥–∞–π–Ω–æ–≥–æ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É

**–§–∞–π–ª**: `indicator.js`, –º–µ—Ç–æ–¥ `_setGateway()` (—Ä—è–¥–æ–∫ 637)

**–ö–æ–¥**:
```javascript
// Force status update by polling immediately
this._statusMonitor._poll();
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ

---

### 2. ‚úÖ –Ü–∫–æ–Ω–∫–∞ –Ω–µ –∑–º—ñ–Ω—é—î—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å retry

**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–ª–∏ CLI –ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ–º–∏–ª–∫—É —ñ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è retry, —ñ–∫–æ–Ω–∫–∞ –∑–º—ñ–Ω—é–≤–∞–ª–∞—Å—å –Ω–∞ "disconnected"

**–ê–Ω–∞–ª—ñ–∑**: –ù–∞—Å–ø—Ä–∞–≤–¥—ñ —Ü–µ **–Ω–µ —î –ø—Ä–æ–±–ª–µ–º–æ—é**. Retry –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –º–µ—Ç–æ–¥—ñ–≤ `connect()` —Ç–∞ `connectToGateway()` –≤ `gpClient.js` –±–µ–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è UI. –Ü–∫–æ–Ω–∫–∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –≤ —Å—Ç–∞–Ω—ñ "connecting" (–∞–Ω—ñ–º–∞—Ü—ñ—è) –ø—ñ–¥ —á–∞—Å –≤—Å—å–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É, –≤–∫–ª—é—á–∞—é—á–∏ retry.

**–ü–æ–≤–µ–¥—ñ–Ω–∫–∞**:
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î Connect
- –Ü–∫–æ–Ω–∫–∞ –∑–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ "connecting" (–∞–Ω—ñ–º–∞—Ü—ñ—è)
- –Ø–∫—â–æ CLI –ø–æ–≤–µ—Ä—Ç–∞—î "already established", –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π retry (–¥–æ 2 —Å–ø—Ä–æ–±)
- –Ü–∫–æ–Ω–∫–∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è "connecting" –≤–µ—Å—å —á–∞—Å
- –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∞–±–æ –ø–æ–º–∏–ª–∫–∏ —ñ–∫–æ–Ω–∫–∞ –∑–º—ñ–Ω—é—î—Ç—å—Å—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ

**–ö–æ–¥ retry** (gpClient.js):
```javascript
if (output.includes('already established')) {
    if (retryCount < 2) {
        log(`GlobalProtect CLI bug detected. Retrying (attempt ${retryCount + 1})...`);
        await new Promise(resolve => setTimeout(resolve, 1000));
        return this.connect(portal, statusCallback, retryCount + 1);
    }
}
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü—Ä–∞—Ü—é—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –∑–º—ñ–Ω–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ

---

### 3. ‚úÖ Host State –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –≤ –æ–∫—Ä–µ–º–æ–º—É –≤—ñ–∫–Ω—ñ

**–ü—Ä–æ–±–ª–µ–º–∞**: Host State –ø–æ–∫–∞–∑—É–≤–∞–≤—Å—è —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ñ notification, —è–∫—ñ –∑–Ω–∏–∫–∞—é—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —ñ –Ω–µ –º–∞—é—Ç—å –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∫–µ—Ä—É–≤–∞–Ω–Ω—è

**–†—ñ—à–µ–Ω–Ω—è**: –°—Ç–≤–æ—Ä–µ–Ω–æ –º–æ–¥–∞–ª—å–Ω–µ –¥—ñ–∞–ª–æ–≥–æ–≤–µ –≤—ñ–∫–Ω–æ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º `ModalDialog` –∑ GNOME Shell UI

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª**:
- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º "GlobalProtect Host State"
- Scrollable –æ–±–ª–∞—Å—Ç—å –¥–ª—è –≤–µ–ª–∏–∫–æ–≥–æ —Ç–µ–∫—Å—Ç—É
- Monospace —à—Ä–∏—Ñ—Ç –¥–ª—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ
- –ö–Ω–æ–ø–∫–∞ "Close" –¥–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ Escape –¥–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É

**–§–∞–π–ª**: `indicator.js`, –º–µ—Ç–æ–¥ `_showHostState()` (—Ä—è–¥–∫–∏ 450-510)

**–î–æ–¥–∞–Ω—ñ imports**:
```javascript
import Clutter from 'gi://Clutter';
import Pango from 'gi://Pango';
import * as ModalDialog from 'resource:///org/gnome/shell/ui/modalDialog.js';
```

**–ö–æ–¥ –¥—ñ–∞–ª–æ–≥—É**:
```javascript
const dialog = new ModalDialog.ModalDialog();

// Title
const titleLabel = new St.Label({
    text: 'GlobalProtect Host State',
    style_class: 'headline',
    x_align: Clutter.ActorAlign.CENTER
});

// Scrollable content
const scrollView = new St.ScrollView({
    style_class: 'globalprotect-host-state-scroll',
    hscrollbar_policy: St.PolicyType.NEVER,
    vscrollbar_policy: St.PolicyType.AUTOMATIC,
    x_expand: true,
    y_expand: true
});

// Monospace text
const stateLabel = new St.Label({
    text: hostState,
    style: 'font-family: monospace; font-size: 10pt;'
});

// Close button
dialog.addButton({
    label: 'Close',
    action: () => dialog.close(),
    key: Clutter.KEY_Escape
});

dialog.open();
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ

---

## üìä –ü–Ü–î–°–£–ú–û–ö

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ**: 3 –∑ 3 –ø—Ä–æ–±–ª–µ–º (100%)

### –ö—Ä–∏—Ç–∏—á–Ω—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:
- ‚úÖ –ü–æ–º–∏–ª–∫–∞ checkStatus –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚úÖ Retry –ª–æ–≥—ñ–∫–∞ –ø—Ä–∞—Ü—é—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–Ω–µ –ø–æ—Ç—Ä–µ–±—É—î –∑–º—ñ–Ω)
- ‚úÖ Host State –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –≤ –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ

### –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ:
- –î–æ–¥–∞–Ω–æ 3 –Ω–æ–≤—ñ imports (Clutter, Pango, ModalDialog)
- –°—Ç–≤–æ—Ä–µ–Ω–æ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∏–π UI –¥—ñ–∞–ª–æ–≥ –∑ scroll —Ç–∞ –∫–Ω–æ–ø–∫–∞–º–∏
- –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –≤–∏–∫–ª–∏–∫ –Ω–µ—ñ—Å–Ω—É—é—á–æ–≥–æ –º–µ—Ç–æ–¥—É

---

## üîÑ –ù–ê–°–¢–£–ü–ù–Ü –ö–†–û–ö–ò

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ GNOME Shell

**–ù–∞ Wayland (–≤–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞)**:
```bash
# –í–∏–π—Ç–∏ –∑ —Å–µ—Å—ñ—ó —Ç–∞ —É–≤—ñ–π—Ç–∏ –∑–Ω–æ–≤—É
```

–ê–±–æ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ (–º–æ–∂–µ –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞—Ç–∏):
```bash
gnome-extensions disable globalprotect@username.github.io
sleep 2
gnome-extensions enable globalprotect@username.github.io
```

### 2. –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

**–¢–µ—Å—Ç 1 - Gateway –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è**:
1. –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å –¥–æ VPN
2. –í—ñ–¥–∫—Ä–∏—Ç–∏ Select Gateway
3. –í–∏–±—Ä–∞—Ç–∏ —ñ–Ω—à–∏–π gateway
4. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –Ω–µ–º–∞—î –ø–æ–º–∏–ª–∫–∏ "checkStatus is not a function"
5. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤—ñ–¥–±—É–ª–æ—Å—å –¥–æ –æ–±—Ä–∞–Ω–æ–≥–æ gateway

**–¢–µ—Å—Ç 2 - Host State –¥—ñ–∞–ª–æ–≥**:
1. –í—ñ–¥–∫—Ä–∏—Ç–∏ –º–µ–Ω—é extension
2. Show ‚Üí Host State
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤—ñ–¥–∫—Ä–∏–ª–æ—Å—å –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ (–Ω–µ notification)
4. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —î –∫–Ω–æ–ø–∫–∞ Close
5. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ Escape –∑–∞–∫—Ä–∏–≤–∞—î –≤—ñ–∫–Ω–æ
6. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —Ç–µ–∫—Å—Ç –≤ monospace —à—Ä–∏—Ñ—Ç—ñ
7. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ scroll —è–∫—â–æ —Ç–µ–∫—Å—Ç –≤–µ–ª–∏–∫–∏–π

**–¢–µ—Å—Ç 3 - Retry –ø–æ–≤–µ–¥—ñ–Ω–∫–∞**:
1. –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å
2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —ñ–∫–æ–Ω–∫–∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è "connecting" –ø—ñ–¥ —á–∞—Å retry
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –Ω–µ–º–∞—î –º–∏–≥–æ—Ç—ñ–Ω–Ω—è —ñ–∫–æ–Ω–∫–∏

### 3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏

```bash
journalctl -f -o cat /usr/bin/gnome-shell | grep -i globalprotect
```

–®—É–∫–∞—Ç–∏:
- ‚úÖ –ù–µ–º–∞—î –ø–æ–º–∏–ª–æ–∫ "checkStatus is not a function"
- ‚úÖ –ù–µ–º–∞—î –ø–æ–º–∏–ª–æ–∫ –∑ ModalDialog
- ‚úÖ Retry –ª–æ–≥–∏ –ø–æ–∫–∞–∑—É—é—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É –ø–æ–≤–µ–¥—ñ–Ω–∫—É

---

## üìù –§–ê–ô–õ–ò –ó–ú–Ü–ù–ï–ù–û

1. **indicator.js**:
   - –î–æ–¥–∞–Ω–æ imports: Clutter, Pango, ModalDialog
   - –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ `_setGateway()`: checkStatus ‚Üí _poll()
   - –ü–µ—Ä–µ–ø–∏—Å–∞–Ω–æ `_showHostState()`: notification ‚Üí modal dialog

2. **–Ü–Ω—à—ñ —Ñ–∞–π–ª–∏**: –ë–µ–∑ –∑–º—ñ–Ω

---

## ‚ú® –ì–û–¢–û–í–ù–Ü–°–¢–¨

Extension –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É GNOME Shell. –í—Å—ñ 3 –ø—Ä–æ–±–ª–µ–º–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ —Ç–∞ –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω—ñ –Ω–∞ —Ä—ñ–≤–Ω—ñ –∫–æ–¥—É.

**–í–µ—Ä—Å—ñ—è**: 1.0.1
**–°—Ç–∞—Ç—É—Å**: Ready for Testing üß™
